<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/layout/template-with-menu.xhtml">

	<ui:define name="body">
		<h:form prependId="false">
		#{draftDespatchBean.openDraftDespatchPage()}
	<h3>#{msg['app.portal.menu.despatch.title']}</h3>
			<p:outputPanel id="buttonPanel">
				<p:commandButton
					value="#{msg['app.portal.despatch.buttons.new.title']}"
					style="background-color:orange !important"
					onclick="PF('DlgNewDespatch').show()" process="@this"
					update="pnlNewDespatch" />
				<p:commandButton
					value="#{msg['app.portal.despatch.buttons.edit.title']}"
					style="background-color:blue !important color:white" 
					onclick="PF('dlgEditDespatch').show()"
					rendered="#{draftDespatchBean.selectedDraftDespatch!=null}"/>
				<p:commandButton
					value="#{msg['app.portal.despatch.buttons.send.title']}"
					style="background-color:green !important color:white" 
					rendered="#{draftDespatchBean.selectedDraftDespatch!=null}"/>
				<p:commandButton
					value="#{msg['app.portal.despatch.buttons.delete.title']}"
					style="background-color:red !important" 
					rendered="#{draftDespatchBean.selectedDraftDespatch!=null}"/>
			</p:outputPanel>
			<p:outputPanel id="pnlDespatchDataTable">
				<p:dataTable var="despatch" id="draftDespatchDataTable"
					value="#{draftDespatchBean.draftDespatchList}"
					rowKey="#{despatch.uuid}" selectionMode="single"
					selection="#{draftDespatchBean.selectedDraftDespatch}">
					
					<p:ajax event="rowSelect" update="buttonPanel"/>
					<p:ajax event="rowUnselect" update="buttonPanel"/>
					
					<p:column
						headerText="#{msg['app.portal.despatch.draftDespatchDataTable.column.despatchId.title']}">
						<p:outputLabel value="#{despatch.despatchId}" />
					</p:column>
					<p:column
						headerText="#{msg['app.portal.despatch.draftDespatchDataTable.column.despatchUUID.title']}">
						<p:outputLabel value="#{despatch.uuid}" />
					</p:column>
					<p:column
						headerText="#{msg['app.portal.despatch.draftDespatchDataTable.column.despatchDate.title']}">
						<p:outputLabel value="#{despatch.despatchDate}">
							<f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
						</p:outputLabel>
					</p:column>
					<p:column
						headerText="#{msg['app.portal.despatch.draftDespatchDataTable.column.sender.title']}">
						<p:outputLabel value="#{despatch.sender}" />
					</p:column>
					<p:column
						headerText="#{msg['app.portal.despatch.draftDespatchDataTable.column.receiver.title']}">
						<p:outputLabel value="#{despatch.receiver}" />
					</p:column>
					<p:column
						headerText="#{msg['app.portal.despatch.draftDespatchDataTable.column.status.title']}">
						<p:outputLabel value="#{despatch.status}" />
					</p:column>
				</p:dataTable>
			</p:outputPanel>
			<p:dialog widgetVar="DlgNewDespatch">
				<p:outputPanel id="pnlNewDespatch">
					<p:panelGrid columns="5">
						<p:outputLabel
							value="#{msg['app.portal.despatch.draftDespatchDataTable.column.despatchUUID.title']}" />
						<p:inputText
							value="#{draftDespatchBean.currentDraftDespatch.uuid}"
							required="true" />
						<p:spacer width="5px" />
						<p:outputLabel
							value="#{msg['app.portal.despatch.draftDespatchDataTable.column.despatchId.title']}" />
						<p:inputText
							value="#{draftDespatchBean.currentDraftDespatch.despatchId}"
							required="true" />

						<p:outputLabel
							value="#{msg['app.portal.despatch.draftDespatchDataTable.column.sender.title']}" />
						<p:inputText
							value="#{draftDespatchBean.currentDraftDespatch.sender}" />
						<p:spacer width="5px" />
						<p:outputLabel
							value="#{msg['app.portal.despatch.draftDespatchDataTable.column.receiver.title']}" />
						<p:inputText
							value="#{draftDespatchBean.currentDraftDespatch.receiver}" />
					</p:panelGrid>
					<p:outputPanel>
						<p:commandButton
							value="#{msg['app.portal.despatch.buttons.save.title']}"
							action="#{draftDespatchBean.saveDespatch()}" global="false"
							oncomplete="if (!args.validationFailed) PF('DlgNewDespatch').hide()"
							process="@this,pnlNewDespatch"
							update="pnlNewDespatch pnlDespatchDataTable" />
						<p:commandButton
							value="#{msg['app.portal.despatch.buttons.clear.title']}"
							action="#{draftDespatchBean.clearCurrentDraftDespatch()}"
							process="@this,pnlNewDespatch" update="pnlNewDespatch" />
					</p:outputPanel>
				</p:outputPanel>
			</p:dialog>



			<p:dialog widgetVar="dlgEditDespatch">
				<p:outputPanel id="pnlEditDespatch">
					<p:panelGrid columns="5">
						<p:outputLabel
							value="#{msg['app.portal.despatch.draftDespatchDataTable.column.despatchUUID.title']}" />
						<p:inputText
							value="#{draftDespatchBean.selectedDraftDespatch.uuid}" 
							required="true"/>
						<p:spacer width="5px" />
						<p:outputLabel
							value="#{msg['app.portal.despatch.draftDespatchDataTable.column.despatchId.title']}" />
						<p:inputText
							value="#{draftDespatchBean.selectedDraftDespatch.despatchId}" 
							required="true"/>

						<p:outputLabel
							value="#{msg['app.portal.despatch.draftDespatchDataTable.column.sender.title']}" />
						<p:inputText
							value="#{draftDespatchBean.selectedDraftDespatch.sender}" />
						<p:spacer width="5px" />
						<p:outputLabel
							value="#{msg['app.portal.despatch.draftDespatchDataTable.column.receiver.title']}" />
						<p:inputText
							value="#{draftDespatchBean.selectedDraftDespatch.receiver}" />
					</p:panelGrid>
					<p:outputPanel>
						<p:commandButton
							value="#{msg['app.portal.despatch.buttons.save.title']}"
							action="#{draftDespatchBean.editDespatch()}" global="false"
							oncomplete="if(args.validDespatch) PF('dlgEditDespatch').hide()"
							process="@this,pnlEditDespatch"
							update="pnlEditDespatch pnlDespatchDataTable" />
						<p:commandButton
							value="#{msg['app.portal.despatch.buttons.clear.title']}"
							onclick="PF('dlgEditDespatch').hide()" />
					</p:outputPanel>
				</p:outputPanel>
			</p:dialog>
		</h:form>

	</ui:define>
</ui:composition>